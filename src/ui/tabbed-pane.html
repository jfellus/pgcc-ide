
<dom-module id="tabbed-pane">
<style>
:host {
	display:flex;
	width:100%; height:100%;
	background:white;
	border-radius:8px;
	box-sizing: border-box;
	border:1px solid #cccccc;
	box-shadow: 1px 1px 2px rgba(0,0,0,0.1);
	flex-direction: column;
	justify-content: flex-start;
	align-items: stretch;
	padding:0; margin:0;
}

#header {
	position:relative;
	display:flex; width:100%;
	justify-content: flex-start;
	align-items: stretch;
	height:auto;
	flex-direction: row;
	background:#dddddd;
	/*border-bottom:1px solid #cccccc;*/
	white-space: nowrap;
	overflow:hidden;
	border-top-left-radius:8px;
	border-top-right-radius:8px;
	padding:0; margin:0;
	border:none;
	min-height:20px;
}

#header > div {
	position:relative;
	display:inline-block;
	padding:6px;
	color:rgba(0,0,0,0.66);
	/*transition:all 0.2s;*/
	cursor:hand;
}


#header > div:hover {
	white-space: nowrap;
	background:#f0f0f0;
	border-top-left-radius:8px;
	border-top-right-radius:8px;
	color:black;
	z-index:0;
}


#header > div.active {
	background:white;
	box-shadow: 0 0 45px rgba(0,0,0,0.5);
	border-top:1px solid rgba(0,0,0,0.2);
	border-right:1px solid rgba(0,0,0,0.2);
	border-top-left-radius:8px;
	border-top-right-radius:8px;
	color:black;
	border-bottom:13px solid white;
	margin-bottom:-13px;
	z-index: 1000;
}

#content {
	padding:10px;
	display:flex;
	flex:1;
	background:white;
}

span.close {
	margin-left: 3px;
	padding: 6px;
	font-weight: bold;
	color: rgba(100,200,0,0.4);
	background: url('../resources/icons/close_tab.png') no-repeat 0px;
	width: 20px;
	height: 20px;
	visibility:hidden;
}
span.close:hover {
	background-image: url("../resources/icons/close_tab_hover.png");
}
#header > div.active span.close { visibility: visible; }
#header > div:hover span.close { visibility: visible; }

#botline {
		position:absolute;
		width:100%;
		bottom:0;
		border-bottom:1px solid rgba(0,0,0,0.2);
		box-shadow:0 -1px 1px rgba(0,0,0,0.1);
		z-index:1;
}

</style>
<template>
	<div id="header">
		<span id="botline"></span>
		<template is="dom-repeat" items="{{tabs}}">
			<div on-tap="selectTab">{{item}}<span class="close" on-tap="closeTab"></span></div>
		</template>
	</div>
	<div id="content">
	</div>
</template>
</dom-module>
<script>

Polymer({
	is: 'tabbed-pane',
	properties: {
		selected:{notify:true},
		tabs:{notify:false,value:[]}
	},

	attached: function () {
		if(this.tabs.length != 0) return;
		this.selectTab($(this.$.header).children().eq(1));

		for(var i =0; i<3; i++) {
			var e = document.createElement("div");
			$(e).html("prout "+ i);
			$(e).attr("label", "Prout"+i);
			this.addTab(e);
		}
	},

	addTab: function(element) {
		var label = element.label;
		if(!label) label = $(element).attr("label");
		if(!label) label = element.tagName;

		$(element).attr("label", label);
		$(element).hide();
		$(this.$.content).append($(element));
		this.push('tabs', label);
		this.selectTab(label);
	},

	selectTab: function(tab) {
		var that = this;
		if(tab && typeof(tab)==="string") {
			$(this.$.header).children().each(function() {
				$(this).removeClass("active");
				var tabId = $(this).text().replace(" ", "");
				var tabContent = $(that.$.content).children("[label='"+tabId+"']");
				tabContent.hide();
				if(tabId !== tab) return;
				$(this).addClass("active");
				tabContent.show();
			});
		} else if(tab.target) {
			tab.stopPropagation(); tab.preventDefault();
			var tabId = $(tab.target).text().replace(" ", "");
			return this.selectTab(tabId);
		} else if(tab.text) {
			var tabId = $(tab).text().replace(" ", "");
			return this.selectTab(tabId);
		}
	},

	closeTab: function(tab) {
		var that = this;
		if(tab && typeof(tab)==="string") {
			$(this.$.header).children().each(function() {
				var tabId = $(this).text().replace(" ", "");
				if(tabId !== tab) return;
				if($(this).hasClass("active")) that.selectTab($(this).next().length ? $(this).next() : $(this).prev());
				that.splice('tabs', that.tabs.indexOf(tabId), 1);
			});
		}
		else if(tab.target) {
			tab.stopPropagation(); tab.preventDefault();
			var tabId = $(tab.target).parent().text().replace(" ", "");
			return this.closeTab(tabId);
		}
	}
});


</script>
